{
  "manifest": {
    "name": "ipfs-grpc-server",
    "version": "0.12.0",
    "description": "A server library for the IPFS gRPC API",
    "license": "Apache-2.0 OR MIT",
    "homepage": "https://github.com/ipfs/js-ipfs/tree/master/packages/ipfs-grpc-server#readme",
    "repository": {
      "type": "git",
      "url": "git+https://github.com/ipfs/js-ipfs.git"
    },
    "bugs": {
      "url": "https://github.com/ipfs/js-ipfs/issues"
    },
    "keywords": [
      "ipfs"
    ],
    "engines": {
      "node": ">=16.0.0",
      "npm": ">=7.0.0"
    },
    "type": "module",
    "types": "./dist/src/index.d.ts",
    "typesVersions": {
      "*": {
        "*": [
          "*",
          "dist/*",
          "dist/src/*",
          "dist/src/*/index"
        ],
        "src/*": [
          "*",
          "dist/*",
          "dist/src/*",
          "dist/src/*/index"
        ]
      }
    },
    "files": [
      "src",
      "dist",
      "!dist/test",
      "!**/*.tsbuildinfo"
    ],
    "exports": {
      ".": {
        "types": "./dist/src/index.d.ts",
        "import": "./src/index.js"
      }
    },
    "eslintConfig": {
      "extends": "ipfs",
      "parserOptions": {
        "sourceType": "module"
      }
    },
    "scripts": {
      "lint": "aegir lint",
      "test": "aegir test -t node",
      "test:node": "aegir test -t node --cov",
      "clean": "aegir clean",
      "dep-check": "aegir dep-check -i ipfs-grpc-protocol -i aegir -i ipfs-core -i ipfs-core-types",
      "build": "aegir build --no-bundle"
    },
    "dependencies": {
      "@grpc/grpc-js": "^1.1.8",
      "@libp2p/logger": "^2.0.0",
      "@libp2p/peer-id": "^2.0.0",
      "@multiformats/multiaddr": "^11.0.0",
      "change-case": "^4.1.1",
      "coercer": "^1.1.2",
      "ipfs-core-types": "^0.14.0",
      "ipfs-grpc-protocol": "^0.8.0",
      "it-first": "^2.0.0",
      "it-map": "^2.0.0",
      "it-peekable": "^2.0.0",
      "it-pipe": "^2.0.3",
      "it-pushable": "^3.0.0",
      "nanoid": "^4.0.0",
      "protobufjs": "^7.0.0",
      "uint8arrays": "^4.0.2",
      "ws": "^8.5.0"
    },
    "devDependencies": {
      "@types/ws": "^8.5.3",
      "aegir": "^37.11.0",
      "ipfs-core": "^0.18.0",
      "it-all": "^2.0.0",
      "it-drain": "^2.0.0",
      "sinon": "^15.0.1"
    },
    "_registry": "npm",
    "_loc": "/home/ubuntu/.cache/yarn/v6/npm-ipfs-grpc-server-0.12.0-integrity/node_modules/ipfs-grpc-server/package.json",
    "readmeFilename": "README.md",
    "readme": "# ipfs-grpc-server <!-- omit in toc -->\n\n[![ipfs.io](https://img.shields.io/badge/project-IPFS-blue.svg?style=flat-square)](http://ipfs.io)\n[![IRC](https://img.shields.io/badge/freenode-%23ipfs-blue.svg?style=flat-square)](http://webchat.freenode.net/?channels=%23ipfs)\n[![Discord](https://img.shields.io/discord/806902334369824788?style=flat-square)](https://discord.gg/ipfs)\n[![codecov](https://img.shields.io/codecov/c/github/ipfs/js-ipfs.svg?style=flat-square)](https://codecov.io/gh/ipfs/js-ipfs)\n[![CI](https://img.shields.io/github/workflow/status/ipfs/js-ipfs/test%20&%20maybe%20release/master?style=flat-square)](https://github.com/ipfs/js-ipfs/actions/workflows/js-test-and-release.yml)\n\n> A server library for the IPFS gRPC API\n\n## Table of contents <!-- omit in toc -->\n\n- [Install](#install)\n- [Why?](#why)\n- [Protocol](#protocol)\n  - [1. Metadata](#1-metadata)\n  - [2. Messages](#2-messages)\n    - [Signal](#signal)\n    - [Header](#header)\n    - [Message data](#message-data)\n    - [Trailer](#trailer)\n- [Handlers](#handlers)\n  - [Metadata](#metadata)\n  - [Unary](#unary)\n  - [Server streaming](#server-streaming)\n  - [Client streaming](#client-streaming)\n  - [Bidirectional streaming](#bidirectional-streaming)\n- [License](#license)\n- [Contribute](#contribute)\n\n## Install\n\n```console\n$ npm i ipfs-grpc-server\n```\n\n## Why?\n\n[gRPC-web](https://github.com/grpc/grpc/blob/master/doc/PROTOCOL-WEB.md) allows us to form HTTP requests out of gRPC invocations, but the [official implementation](https://github.com/grpc/grpc-web) supports only unary calls and server streaming, which in terms of functionality doesn't give us much over the existing [ipfs-http-client](https://www.npmjs.com/package/ipfs-http-client).\n\nIn order to support streaming file uploads with errors, pubsub, etc, bi-directional streaming is required.  We can either use Websockets for this, or use two connections, one for upload and one for download though this involves two requests for every operation and some orchestration on the server side to match one up with the other.\n\nWebsockets are a cheaper and simpler way of accomplishing the same thing though sadly the official gRPC implementation has [no plans](https://github.com/grpc/grpc-web/blob/master/doc/streaming-roadmap.md#issues-with-websockets) to implement full-duplex streaming in this way.\n\nThis module implements a Websocket proxy for a gRPC-web server.  It's a js port of the [grpcwebproxy](https://github.com/improbable-eng/grpc-web/tree/master/go/grpcwebproxy) project from [improbable-eng/grpc-web](https://github.com/improbable-eng/grpc-web).\n\n## Protocol\n\nEvery RPC invocation opens a new WebSocket connection, the invocation is completed and the socket connection is closed.\n\nThe connection is opened against the path of the RPC method the client wishes to invoke.  The path is created from the protobuf service definition package, service and procedure name.\n\nE.g. given the following service definition:\n\n```protobuf\npackage ipfs;\n\nservice Root {\n  rpc id (Req) returns (Res) {}\n}\n```\n\nA path of `/ipfs.Root/id` would be created.\n\nThere are three parts to the communication, metadata, messages and trailers.  Communication is symmetrical; that is, the client sends metadata, one or more messages and finally some trailers and the server responds with metadata, one or more messages and finally some trailers.\n\nThe amount of messages a client/server can send is dictated by if the RPC method is unary or streaming and if so in which direction.\n\nUnary will result in one message sent and one received, client streaming is many sent and one received, server streaming is one sent and many received and finally bidirectional is many sent and many received.\n\n### 1. Metadata\n\nMetadata is sent as the first websocket message. It is a utf8 encoded list in the same format as [HTTP Headers][]\n\n### 2. Messages\n\nOne ore more messages will be sent.  Messages are sent as a single websocket message and contain a signal, a header, some message data and an optional trailer.\n\nEvery message sent to or received from the server will have the following format:\n\n| byte index | Notes        |\n| ---------- | ------------ |\n| 0          | Signal       |\n| 1-5        | Header       |\n| n1-n2      | Message data |\n| n3-n3+5    | Trailer      |\n\n#### Signal\n\nA one-byte field.\n\n| Value | Meaning                                                               |\n| ----- | --------------------------------------------------------------------- |\n| 0     | START\\_SEND: Further messages will be sent as part of this context    |\n| 1     | FINISH\\_SEND: This is the final message, no further data will be sent |\n\n#### Header\n\nA five-byte field that contains one byte signifying if it's a Header or a Trailer and four bytes that contain the length of the following data.\n\n| byte index | Meaning                                                                        |\n| ---------- | ------------------------------------------------------------------------------ |\n| 0          | 0: This is a header, 128: This is a footer                                     |\n| 1-4        | An unsigned big-endian 32-bit integer that specifies the length of the message |\n\n#### Message data\n\nA protocol buffer message, the length of which is defined in the header\n\n#### Trailer\n\nA five-byte field that contains one byte signifying if it's a Header or a Trailer and four bytes that contain the length of the following data.\n\n| byte index | Meaning                                                              |\n| ---------- | -------------------------------------------------------------------- |\n| 0          | 0: This is a header, 128: This is a footer                           |\n| 1-4        | A big-endian 32-bit integer that specifies the length of the trailer |\n\nThe trailer contains [HTTP headers][] as a utf8 encoded string in the same way as invocation metadata.\n\n## Handlers\n\nMethod handlers come in four flavours - unary, server streaming, client streaming, bidirectional streaming and accept metadata as an argument.\n\n### Metadata\n\nAll methods accept metadata which are sent as the equivalent of HTTP headers as part of every request.  These are accepted by the client as options to a given method.\n\nE.g.:\n\n```js\nipfs.addAll(source, options)\n// `source` will be turned into a message stream\n// `options` will be sent as metadata\n```\n\n### Unary\n\nThe simplest case, one request message and one response message.\n\n```javascript\nexport function grpcFunction (ipfs, options = {}) {\n  async function handler (request, metadata) {\n    const response = {\n      //... some fields here\n    }\n\n    return response\n  }\n\n  return handler\n}\n```\n\n### Server streaming\n\nWhere the server sends multiple messages.  `sink` is an [it-pushable][].\n\n```javascript\nexport function grpcFunction (ipfs, options = {}) {\n  async function serverStreamingHandler (request, sink, metadata) {\n    sink.push(..)\n    sink.push(..)\n\n    sink.end()\n  }\n\n  return clientStreamingHandler\n}\n```\n\n### Client streaming\n\nWhere the client sends multiple messages.  `source` is an [AsyncIterator][].\n\n```javascript\nexport function grpcFunction (ipfs, options = {}) {\n  async function clientStreamingHandler (source, metadata) {\n    const response = {\n      //... some fields here\n    }\n\n    for await (const thing of source) {\n      // do something with `thing`\n    }\n\n    return response\n  }\n\n  return handler\n}\n```\n\n### Bidirectional streaming\n\nWhere the client and the server both send multiple messages.  `source` is an [AsyncIterator][] and `sink` is an [it-pushable][].\n\n```javascript\nexport function grpcFunction (ipfs, options = {}) {\n  async function bidirectionalHandler (source, sink, metadata) {\n    for await (const thing of source) {\n      sink.push(sink)\n    }\n\n    sink.end()\n  }\n\n  return bidirectionalHandler\n}\n```\n\n## License\n\nLicensed under either of\n\n- Apache 2.0, ([LICENSE-APACHE](LICENSE-APACHE) / <http://www.apache.org/licenses/LICENSE-2.0>)\n- MIT ([LICENSE-MIT](LICENSE-MIT) / <http://opensource.org/licenses/MIT>)\n\n## Contribute\n\nContributions welcome! Please check out [the issues](https://github.com/ipfs/js-ipfs/issues).\n\nAlso see our [contributing document](https://github.com/ipfs/community/blob/master/CONTRIBUTING_JS.md) for more information on how we work, and about contributing in general.\n\nPlease be aware that all interactions related to this repo are subject to the IPFS [Code of Conduct](https://github.com/ipfs/community/blob/master/code-of-conduct.md).\n\nUnless you explicitly state otherwise, any contribution intentionally submitted for inclusion in the work by you, as defined in the Apache-2.0 license, shall be dual licensed as above, without any additional terms or conditions.\n\n[![](https://cdn.rawgit.com/jbenet/contribute-ipfs-gif/master/img/contribute.gif)](https://github.com/ipfs/community/blob/master/CONTRIBUTING.md)\n\n[HTTP headers]: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers\n\n[it-pushable]: https://www.npmjs.com/package/it-pushable\n\n[AsyncIterator]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/asyncIterator\n",
    "licenseText": "This project is dual licensed under MIT and Apache-2.0.\n\nMIT: https://www.opensource.org/licenses/mit\nApache-2.0: https://www.apache.org/licenses/license-2.0\n"
  },
  "artifacts": [],
  "remote": {
    "resolved": "https://registry.npmjs.org/ipfs-grpc-server/-/ipfs-grpc-server-0.12.0.tgz",
    "type": "tarball",
    "reference": "https://registry.npmjs.org/ipfs-grpc-server/-/ipfs-grpc-server-0.12.0.tgz",
    "hash": "",
    "integrity": "sha512-fF9hjg/JK26oIGrqVQ2IBzZZ8ll3AptrMNg3UBDbKX4UTVeJMVGpE6xrfVTzYSUsnUOttFgtdHw/6D093YbqvA==",
    "registry": "npm",
    "packageName": "ipfs-grpc-server",
    "cacheIntegrity": "sha512-fF9hjg/JK26oIGrqVQ2IBzZZ8ll3AptrMNg3UBDbKX4UTVeJMVGpE6xrfVTzYSUsnUOttFgtdHw/6D093YbqvA== sha1-1AfL02sLuJb21IyMeMwssIa7y1M="
  },
  "registry": "npm",
  "hash": "7c5f618e0fc92b6ea8206aea550d88073659f25977029b6b30d8375010db297e144d57893151a913ac6b7d54f361252c9d43adb4582d747c3fe83d3ddd86eabc"
}